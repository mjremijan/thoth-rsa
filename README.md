# Thoth RSA

Research on using `ssh-keygen` or `openssl` to generate public/private keys
which a Java application can use.

# Java using keys example

This assumes that the key files are serialized Java objects, not the `ssh-keygen` generated files.

## References

<https://javadigest.wordpress.com/2012/08/26/rsa-encryption-example/>


# Java read id_rsa file example

Private RSA key uses `PKCS8EncodedKeySpec` \[1\]

Public RSA key uses `X509EncodedKeySpec` \[1\]

The files generated by `ssh-keygen -t rsa -b 1024` need some parsing
to remove newline characters as well as inline comments \[2\]. Further
the keys generated are "bare" PKCS1 formatted whereas Java needs
PKCS8 format \[3\]. You can tell a private key is in PKCS1 format because the comment
in the file says "-----BEGIN RSA PRIVATE KEY-----". For a PKCS8 format, the comment says
"-----BEGIN PRIVATE KEY-----" without the **RSS**. So it looks like additional translation is needed to
create files in PKCS#8 format \[4\]. Probably better to just use openssl \[2, 5\]:

```text
# Generate private key in pkcs1 format
#openssl genrsa -out private_key_rsa_4096_pkcs1.pem 4096

# Export private key to pkcs8 format
#openssl pkcs8 -topk8 -in private_key_rsa_4096_pkcs1.pem -inform pem -out private_key_rsa_4096_pkcs8-exported.pem -outform pem -nocrypt

# Generate private key in pkcs8 format
openssl genpkey -out private_key_rsa_4096_pkcs8-generated.pem -algorithm RSA -pkeyopt rsa_keygen_bits:4096

# Export public key in pkcs8 format
openssl rsa -pubout -outform pem -in private_key_rsa_4096_pkcs8.pem -out public_key_rsa_4096_pkcs8.pem

```

## References
1. Java Code Examples for `java.security.PrivateKey`. <http://www.javased.com/index.php?api=java.security.PrivateKey>

2. ParseRSAKeys.java <https://gist.github.com/destan/b708d11bd4f403506d6d5bb5fe6a82c5>

3. Load an RSA private key in Java (algid parse error, not a sequence). <https://stackoverflow.com/questions/15344125/load-a-rsa-private-key-in-java-algid-parse-error-not-a-sequence/29827944>

4. Why can't ssh-keygen export a public key in PEM PKCS8 format? <https://crypto.stackexchange.com/questions/27913/why-can-ssh-keygen-export-a-public-key-in-pem-pkcs8-format>



# Encrypt something with the key

```text
## This reads in a file
openssl rsautl -encrypt -inkey public_key_rsa_4096_pkcs8.pem -pubin -in plaintext.txt -out foo.dat 
```

```text
## This uses echo
echo "does the ECHO work?" | openssl rsautl -encrypt -inkey public_key_rsa_4096_pkcs8.pem -pubin -out foo.dat
```

```text
## This uses echo and base64
## This dat file has multiple lines. If the newlines are removed it decodes fine
## got to figure if multiple lines can be avoided.
echo "abc123" | openssl rsautl -encrypt -inkey public_key_rsa_4096_pkcs8.pem -pubin | openssl enc -A -base64 > base64.dat
```

```text
## This reads a file and then base64
openssl rsautl -encrypt -inkey public_key_rsa_4096_pkcs8.pem -pubin -in plaintext.txt | openssl enc -A -base64 > base64.dat
```

```text
## This is echo, base64, sed, and a properties file. This seems to work OK
## but echo adds a newline at the end...don't want a newline
sed "s|YYY|`echo "abc123" | openssl rsautl -encrypt -inkey public_key_rsa_4096_pkcs8.pem -pubin | openssl enc -A -base64`|g" app.properties > app2.properties
```

```text
## This is printf, base64, sed, and a properties file. printf won't
## add a newline if you don't want it to.
sed "s|YYY|`printf "ending-with newline" | openssl rsautl -encrypt -inkey public_key_rsa_4096_pkcs8.pem -pubin | openssl enc -A -base64`|g" app.properties > app3.properties
```

## References
1. Using OpenSSL to encrypt messages and files on Linux. <https://linuxconfig.org/using-openssl-to-encrypt-messages-and-files-on-linux>

2. How to remove newline from output. <https://stackoverflow.com/questions/35799684/how-to-remove-newline-from-output>